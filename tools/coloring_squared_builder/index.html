<!DOCTYPE html>
<html lang="en">

  <head>
    <title>All Printable | Pixel Art Editor</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
      rel="stylesheet"
    />
    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="/stylesheets/site.css" rel="stylesheet" />
    <!-- Custom CSS -->

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RXLVNSZTCH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RXLVNSZTCH');
</script>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">

  </head>

  <body class="collection-none">
    <header class="no-print">

  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">
        <img src="/assets/images/logo.png" height="60" alt="" loading="lazy"
          style="margin-top: -3px;" />
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarScroll" aria-controls="navbarScroll" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarScroll">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link " href="/">Home</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Coloring Squared
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="/coloring_squared/">All</a></li>
                <li><a class="dropdown-item" href="/coloring_squared/addition/">Addition</a></li>
                <li><a class="dropdown-item" href="/coloring_squared/subtraction/">Subtraction</a></li>
                <li><a class="dropdown-item" href="/coloring_squared/addition_and_subtraction/">Addition & Subtraction</a></li>
                <li><a class="dropdown-item" href="/coloring_squared/multiplication/">Multiplication</a></li>
                <li><a class="dropdown-item" href="/coloring_squared/division/">Division</a></li>
                <li><a class="dropdown-item" href="/coloring_squared/multiplication_and_division/">Multiplication & Division</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Tools
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="/tools/coloring_squared_builder/">Create coloring squared page</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- Navbar -->
</header>

    <main class="my-5">
      <div class="container">
        <style>
    /* Basic styling for the pixel art table */
    table {
        border-collapse: collapse;
    }
    tr td:nth-child(9),
    tr td:nth-child(10) {
        /* background with a line */
        border-right-color: #000;
    }
    td {
        width: 40px;
        min-width: 40px;
        height: 40px;
        border: 1px solid #ccc;
        cursor: pointer;
    }
    .color-palette {
        margin-top: 10px;
    }
    .color-box {
        width: 30px;
        height: 30px;
        display: inline-block;
        margin-right: 5px;
        border: 1px solid #000;
        cursor: pointer;
    }

    .color-box.active {
        border: 2px solid #000;
    }

    .color-box.active:before {
        content: 'âœ”';
        font-size: 20px;
        color: white;
        position: absolute;
        margin-left: 10px;
    }

    .color-box.active[data-color="white"]:before,
    .color-box.active[data-color="yellow"]:before,
    .color-box.active[data-color="lightgreen"]:before,
    .color-box.active[data-color="cyan"]:before,
    .color-box.active[data-color="pink"]:before {
        color: black;
    }

    .tools {
        margin-top: 10px;
    }

    .tools button {
        padding: 5px 10px;
        margin-right: 5px;
        cursor: pointer;
    }

    .tools button.active-tool {
        background-color: #ccc;
    }

    [data-color="black"] {
        background-color: black;
    }

    [data-color="gray"] {
        background-color: gray;
    }

    [data-color="white"] {
        background-color: white;
    }

    [data-color="red"] {
        background-color: red;
    }

    [data-color="orange"] {
        background-color: orange;
    }

    [data-color="yellow"] {
        background-color: yellow;
    }

    [data-color="lightgreen"] {
        background-color: lightgreen;
    }

    [data-color="green"] {
        background-color: green;
    }

    [data-color="cyan"] {
        background-color: cyan;
    }

    [data-color="blue"] {
        background-color: blue;
    }

    [data-color="purple"] {
        background-color: purple;
    }

    [data-color="pink"] {
        background-color: pink;
    }

    [data-color="brown"] {
        background-color: brown;
    }

    .tools button {
        margin-right: -2px;
    }
</style>

<h1>Pixel Art Editor</h1>
<!-- Pixel Art Table -->
<table id="pixelCanvas">
    <!-- Table rows will be dynamically created using JavaScript -->
</table>

<!-- Color Palette -->
<div class="color-palette">
    <div class="color-box" data-color="black"></div>
    <div class="color-box" data-color="gray"></div>
    <div class="color-box" data-color="white"></div>
    <div class="color-box" data-color="red"></div>
    <div class="color-box" data-color="orange"></div>
    <div class="color-box" data-color="yellow"></div>
    <div class="color-box" data-color="lightgreen"></div>
    <div class="color-box" data-color="green"></div>
    <div class="color-box" data-color="cyan"></div>
    <div class="color-box" data-color="blue"></div>
    <div class="color-box" data-color="purple"></div>
    <div class="color-box" data-color="pink"></div>
    <div class="color-box" data-color="brown"></div>
</div>

<!-- Buttons for Tools -->
<div class="tools">
    <button data-tool="pencil" class="active-tool" title="pencil">
        <i class="fa fa-pencil"></i>
    </button
    ><button
      data-tool="symmetric-pencil" title="Symmetric pencil"
    ><i class="fa fa-pencil"></i>|<i class="fa fa-pencil" style="transform: scale(-1, 1)"></i></button
    ><button data-tool="bucket"><i class="fa-solid fa-fill-drip" title="Paint bucket"></i></button
    >&nbsp;&nbsp;<button id="undo"><i class="fa fa-undo" aria-hidden="true"></i></button
    ><button id="redo"><i class="fa fa-undo" aria-hidden="true" style="transform: scale(-1, 1)"></i></button
    >&nbsp;&nbsp;&nbsp;&nbsp;<button id="new-page">New</button>
</div>



<!-- jQuery Library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- JavaScript Code -->
<script type="text/javascript">
    function objectFlip(obj) {
    const ret = {};
    Object.keys(obj).forEach(key => {
        ret[obj[key]] = key;
    });
    return ret;
    }

    function getHashParams() {
    var hashParams = {};
    var e,
        a = /\+/g,  // Regex for replacing addition symbol with a space
        r = /([^&;=]+)=?([^&;]*)/g,
        d = function (s) { return decodeURIComponent(s.replace(a, " ")); },
        q = window.location.hash.substring(1);

    while (e = r.exec(q))
    hashParams[d(e[1])] = d(e[2]);

    return hashParams;
    }

    function setHashParams(params) {
    var hash = Object.keys(params).map(function(key) {
        return `${key}=${params[key]}`;
    }).join('&');

    window.location.hash = hash;
    }

    $(document).ready(function() {
    const COLOR_TO_CODE = {
        'black': '0',
        'gray': '1',
        'white': '2',
        'red': '3',
        'orange': '4',
        'yellow': '5',
        'lightgreen': '6',
        'green': '7',
        'cyan': '8',
        'blue': '9',
        'purple': 'a',
        'pink': 'b',
        'brown': 'c',
    }
    const CODE_TO_COLOR = objectFlip(COLOR_TO_CODE)
    const canvasSize = 19;
    let currentColor = 'black';
    let currentTool = 'pencil';
    // load history from localStorage
    let history = JSON.parse(localStorage.getItem('history')) || [];
    let redoHistory = [];

    function resetCanvas() {
        $('td').each(function() {
            drawPixelWithoutUpdatingState($(this), 'white');
        });
        saveState();
    }

    // Create pixel art canvas
    function createCanvas() {
        let html = '';
        for (let i = 0; i < canvasSize; i++) {
            html += '<tr>';
            for (let j = 0; j < canvasSize; j++) {
                html += `<td data-color="white"></td>`;
            }
            html += '</tr>';
        }
        $('#pixelCanvas').html(html);

        // Mouse events for drawing
        let isMouseDown = false;
        $('td').mousedown(function() {
            isMouseDown = true;
            let $cell = $(this);
            applyTool($cell);
        }).mouseover(function() {
            if (isMouseDown) {
                let $cell = $(this);
                applyTool($cell);
            }
        });

        $(document).mouseup(function() {
            isMouseDown = false;
            updateURLWithCanvasState();
        });
    }

    function applyTool($cell) {
        switch (currentTool) {
            case 'pencil':
                drawPixel($cell);
                break;
            case 'symmetric-pencil':
                drawSymmetricPixel($cell);
                break;
            case 'bucket':
                fillBucket($cell);
                break;
        }
    }

    // Function to draw a pixel
    function drawPixel($cell) {
        drawPixelWithoutUpdatingState($cell, currentColor)
        saveState();
    }

    function drawPixelWithoutUpdatingState($cell, color) {
        $cell.attr('data-color', color);
    }

    function saveState() {
        const state = getStateString();

        history.push({ state: state });
        if (history.length > 100) {
            history.shift();
        }
        redoHistory = [];

        localStorage.setItem('history', JSON.stringify(history));
        updateURLWithCanvasState();
    }
    // Function to fill all connected cells with the same color
    function fillBucket($cell) {
        let color = $cell.attr('data-color');
        let rowIndex = $cell.closest('tr').index();
        let colIndex = $cell.index();
        let visited = new Set();
        let queue = [[rowIndex, colIndex]];
        while (queue.length) {
            let [row, col] = queue.shift();
            let $currentCell = $('tr').eq(row).find('td').eq(col);
            if (visited.has(`${row}-${col}`) || $currentCell.attr('data-color') !== color) {
                continue;
            }
            visited.add(`${row}-${col}`);
            drawPixelWithoutUpdatingState($currentCell, currentColor);
            if (row > 0) queue.push([row - 1, col]);
            if (row < canvasSize - 1) queue.push([row + 1, col]);
            if (col > 0) queue.push([row, col - 1]);
            if (col < canvasSize - 1) queue.push([row, col + 1]);
        }
        saveState();
    }

    // Function to draw a symmetric pixel
    function drawSymmetricPixel($cell) {
        const colIndex = $cell.index();
        const middleIndex = 9;
        const distanceToMiddle = Math.abs(colIndex - middleIndex);
        const symmetricColIndex = colIndex < middleIndex ? middleIndex + distanceToMiddle: middleIndex - distanceToMiddle;
        const $symmetricCell = $cell.closest('tr').find('td').eq(symmetricColIndex);

        drawPixelWithoutUpdatingState($cell, currentColor)
        drawPixelWithoutUpdatingState($symmetricCell, currentColor);
        saveState();
    }

    // Function to update URL with canvas state
    function updateURLWithCanvasState() {
        const state = getStateString();
        setHashParams({ state: state });
    }

    // Function to get the state string of the canvas
    function getStateString() {
        let state = [];
        $('tr').each(function(rowIndex) {
            $(this).find('td').each(function(colIndex) {
                let color = colorCode($(this).attr('data-color'));
                state.push(color);
            });
        });
        return state.join('');
    }

    function colorCode(color) {
        const code = COLOR_TO_CODE[color]

        if (code) {
        return code
        }

        throw new Error(`Unknown color: ${color}`);
    }


    // Color palette click event
    $('.color-box').click(function() {
        currentColor = $(this).attr('data-color');
        $('.color-box').removeClass('active');
        $(this).addClass('active');
    });

    $('.color-box[data-color="white"]').click();

    // Tool buttons click events
    $('[data-tool]').click(function() {
        currentTool = $(this).attr('data-tool');
        $('[data-tool]').removeClass('active-tool');
        $(this).addClass('active-tool');
    });

    $('#new-page').click(function() {
        // alert
        if (confirm('Are you sure you want to start a new page?')) {
            resetCanvas();
            updateURLWithCanvasState();
        }
    });

    // Undo button click event
    $('#undo').click(function() {
        let lastAction = history.pop();
        redoHistory.push(lastAction)

        if (lastAction) {
            const { state } = lastAction;
            restoreCanvasState(state)
        }
    });

    // Redo button click event
    $('#redo').click(function() {
        const lastRedo = redoHistory.pop();
        if (lastRedo) {
            const { state } = lastRedo
            history.push(lastRedo);
            restoreCanvasState(state);
        }
    });

    // Initialize the canvas
    createCanvas();

    // Check if there's a canvas state in the URL hash on page load
    if (window.location.hash) {
        let hashParams = getHashParams();
        restoreCanvasState(hashParams.state);
    }

    // Function to restore canvas state from a state string
    function restoreCanvasState(stateString) {
        $('tr').each(function(rowIndex) {
            $(this).find('td').each(function(colIndex) {
                let colorCode = stateString.charAt(rowIndex * canvasSize + colIndex);
                let color = CODE_TO_COLOR[colorCode];
                $(this).attr('data-color', color);
            });
        });
    }
});
</script>

      </div>
    </main>

    <footer class="bg-light text-lg-start no-print">
  <!-- Copyright -->
  <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
    Â© 2024 Copyright:
    <a class="text-dark" href="/">All Printable</a>
  </div>
  <!-- Copyright -->
</footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>

</html>
